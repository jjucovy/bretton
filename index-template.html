<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bretton Woods Conference - Multiplayer</title>
    <style>
        /* Bretton Woods Conference Simulation Styles */
        :root {
          --blue-600: #2563eb;
          --red-600: #dc2626;
          --purple-600: #9333ea;
          --amber-600: #d97706;
          --green-600: #16a34a;
        }

        * {
          box-sizing: border-box;
          margin: 0;
          padding: 0;
        }

        body {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
          background: linear-gradient(135deg, #1e3a8a 0%, #1e293b 100%);
          min-height: 100vh;
          padding: 20px;
        }

        .container {
          max-width: 1200px;
          margin: 0 auto;
        }

        .header {
          text-align: center;
          color: white;
          margin-bottom: 40px;
        }

        .header h1 {
          font-size: 3rem;
          font-weight: bold;
          margin-bottom: 10px;
          text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header p {
          font-size: 1.25rem;
          opacity: 0.9;
        }

        .card {
          background: white;
          border-radius: 12px;
          padding: 24px;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
          margin-bottom: 20px;
        }

        .country-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 20px;
          margin-top: 30px;
        }

        .country-card {
          padding: 20px;
          border-radius: 8px;
          color: white;
          cursor: pointer;
          transition: transform 0.2s, box-shadow 0.2s;
        }

        .country-card:hover {
          transform: translateY(-4px);
          box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .country-card h3 {
          font-size: 1.5rem;
          margin-bottom: 12px;
        }

        .country-card ul {
          list-style: none;
          text-align: left;
          font-size: 0.9rem;
        }

        .country-card li {
          margin-bottom: 8px;
          padding-left: 20px;
          position: relative;
        }

        .country-card li:before {
          content: "‚Üí";
          position: absolute;
          left: 0;
        }

        .bg-blue-600 { background-color: var(--blue-600); }
        .bg-red-600 { background-color: var(--red-600); }
        .bg-purple-600 { background-color: var(--purple-600); }
        .bg-amber-600 { background-color: var(--amber-600); }
        .bg-green-600 { background-color: var(--green-600); }

        .text-blue-600 { color: var(--blue-600); }
        .text-red-600 { color: var(--red-600); }
        .text-purple-600 { color: var(--purple-600); }
        .text-amber-600 { color: var(--amber-600); }
        .text-green-600 { color: var(--green-600); }

        button {
          padding: 12px 24px;
          border: none;
          border-radius: 6px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.2s;
          font-size: 1rem;
        }

        .btn-primary {
          background-color: var(--blue-600);
          color: white;
        }

        .btn-primary:hover {
          background-color: #1d4ed8;
          transform: translateY(-2px);
        }

        .btn-secondary {
          background-color: #64748b;
          color: white;
        }

        .btn-success {
          background-color: var(--green-600);
          color: white;
        }

        .btn-danger {
          background-color: var(--red-600);
          color: white;
        }

        .economic-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 16px;
          margin-top: 16px;
        }

        .economic-card {
          background: #f8fafc;
          padding: 16px;
          border-radius: 8px;
          border-left: 4px solid var(--blue-600);
        }

        .economic-card h4 {
          font-size: 0.875rem;
          color: #64748b;
          margin-bottom: 8px;
          text-transform: uppercase;
        }

        .economic-card p {
          font-size: 1.25rem;
          font-weight: bold;
          color: #1e293b;
        }

        .final-scores {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
          gap: 20px;
          margin: 30px 0;
        }

        .score-card {
          padding: 20px;
          border-radius: 8px;
          color: white;
          text-align: center;
        }

        .score-card h3 {
          font-size: 1.125rem;
          margin-bottom: 12px;
        }

        .score-value {
          font-size: 2.5rem;
          font-weight: bold;
        }

        @media (max-width: 768px) {
          .header h1 { font-size: 2rem; }
          .country-grid, .economic-grid, .final-scores { grid-template-columns: 1fr; }
        }

        .emergency-reset {
          position: fixed;
          bottom: 20px;
          right: 20px;
          padding: 12px 20px;
          background: #dc2626;
          color: white;
          border: none;
          border-radius: 8px;
          cursor: pointer;
          font-size: 0.875rem;
          font-weight: 600;
          box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4);
          z-index: 1000;
          transition: all 0.2s;
        }

        .emergency-reset:hover {
          background: #b91c1c;
          transform: translateY(-2px);
          box-shadow: 0 6px 16px rgba(220, 38, 38, 0.5);
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="container">
            <div class="card">
                <p style="text-align: center; padding: 40px;">Loading...</p>
            </div>
        </div>
    </div>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script type="text/babel">
        // Game Data
        const economicData = {
          USA: { goldReserves: 20000, tradeBalance: 6800, gdp: 210000, warDebt: 250000, industrialOutput: 100 },
          UK: { goldReserves: 1800, tradeBalance: -2000, gdp: 61000, warDebt: 120000, industrialOutput: 35 },
          USSR: { goldReserves: 2500, tradeBalance: -1000, gdp: 126000, warDebt: 50000, industrialOutput: 60 },
          France: { goldReserves: 500, tradeBalance: -1500, gdp: 37000, warDebt: 45000, industrialOutput: 15 },
          China: { goldReserves: 300, tradeBalance: -800, gdp: 45000, warDebt: 35000, industrialOutput: 8 }
        };

        const countries = {
          USA: {
            name: "United States",
            color: "bg-blue-600",
            textColor: "text-blue-600",
            objectives: ["Establish dollar as primary reserve currency", "Create stable exchange rates tied to gold"],
            economicPosition: "Creditor nation with 70% of world's gold reserves"
          },
          UK: {
            name: "United Kingdom",
            color: "bg-red-600",
            textColor: "text-red-600",
            objectives: ["Preserve Sterling bloc", "Secure reconstruction loans"],
            economicPosition: "Heavily indebted, trade deficit, declining empire"
          },
          USSR: {
            name: "Soviet Union",
            color: "bg-purple-600",
            textColor: "text-purple-600",
            objectives: ["Obtain reconstruction aid", "Maintain economic sovereignty"],
            economicPosition: "War-devastated, suspicious of capitalist institutions"
          },
          France: {
            name: "France",
            color: "bg-amber-600",
            textColor: "text-amber-600",
            objectives: ["Secure reconstruction financing", "Restore economic stability"],
            economicPosition: "Occupied and devastated, weak negotiating position"
          },
          China: {
            name: "China",
            color: "bg-green-600",
            textColor: "text-green-600",
            objectives: ["Gain international recognition", "Secure development aid"],
            economicPosition: "Underdeveloped, civil war looming, minimal influence"
          }
        };

        const issues = [
          {
            id: 1,
            title: "Reserve Currency System",
            description: "What should be the foundation of the new international monetary system?",
            options: [
              { id: 'a', text: "US Dollar backed by gold (White Plan)", favors: ['USA'], opposes: ['UK', 'USSR'] },
              { id: 'b', text: "International currency Bancor (Keynes Plan)", favors: ['UK', 'France'], opposes: ['USA'] },
              { id: 'c', text: "Multiple reserve currencies", favors: ['USSR', 'UK', 'France'], opposes: ['USA'] }
            ]
          },
          {
            id: 2,
            title: "Exchange Rate System",
            description: "How should exchange rates be managed?",
            options: [
              { id: 'a', text: "Fixed rates pegged to dollar", favors: ['USA'], opposes: ['China'] },
              { id: 'b', text: "Adjustable pegs with flexibility", favors: ['UK', 'France'], opposes: ['USA'] },
              { id: 'c', text: "National sovereignty over rates", favors: ['USSR', 'China'], opposes: ['USA', 'UK'] }
            ]
          },
          {
            id: 3,
            title: "Capital Controls",
            description: "Should countries control capital movements?",
            options: [
              { id: 'a', text: "Free capital movement", favors: ['USA'], opposes: ['UK', 'USSR', 'France', 'China'] },
              { id: 'b', text: "Transitional capital controls", favors: ['UK', 'USSR', 'France', 'China'], opposes: [] },
              { id: 'c', text: "Permanent capital controls", favors: ['USSR', 'China'], opposes: ['USA'] }
            ]
          },
          {
            id: 4,
            title: "IMF Voting Power",
            description: "How to distribute voting power?",
            options: [
              { id: 'a', text: "Weighted by gold and GDP", favors: ['USA'], opposes: ['UK', 'USSR', 'France', 'China'] },
              { id: 'b', text: "Major powers get substantial quotas", favors: ['UK', 'France', 'China'], opposes: ['USA'] },
              { id: 'c', text: "More equal distribution", favors: ['USSR', 'China'], opposes: ['USA', 'UK'] }
            ]
          },
          {
            id: 5,
            title: "Reconstruction Financing",
            description: "How to rebuild war-torn economies?",
            options: [
              { id: 'a', text: "World Bank with US conditions", favors: ['USA'], opposes: ['USSR'] },
              { id: 'b', text: "Large unconditional grants", favors: ['UK', 'USSR', 'France', 'China'], opposes: ['USA'] },
              { id: 'c', text: "Priority for most devastated", favors: ['France', 'China'], opposes: [] }
            ]
          },
          {
            id: 6,
            title: "Currency Stabilization",
            description: "Address hyperinflation in war-torn nations?",
            options: [
              { id: 'a', text: "Market-based reforms", favors: ['USA'], opposes: ['USSR', 'France'] },
              { id: 'b', text: "IMF stabilization loans", favors: ['UK', 'France', 'China'], opposes: [] },
              { id: 'c', text: "State currency controls", favors: ['USSR'], opposes: ['USA', 'UK'] }
            ]
          }
        ];

        // Game State Manager
        class GameStateManager {
          constructor() {
            this.storageKey = 'brettonWoodsGameState';
            this.initializeState();
            window.addEventListener('storage', (e) => {
              if (e.key === this.storageKey) {
                this.notifyListeners();
              }
            });
            this.listeners = [];
          }

          initializeState() {
            const existing = localStorage.getItem(this.storageKey);
            if (!existing) {
              const initialState = {
                gameId: Date.now(),
                gameStarted: false,
                currentRound: 0,
                players: {},
                votes: {},
                readyPlayers: [],
                gamePhase: 'lobby',
                scores: { USA: 0, UK: 0, USSR: 0, France: 0, China: 0 },
                roundHistory: []
              };
              localStorage.setItem(this.storageKey, JSON.stringify(initialState));
            }
          }

          getState() {
            const state = localStorage.getItem(this.storageKey);
            return state ? JSON.parse(state) : null;
          }

          setState(updates) {
            const currentState = this.getState();
            const newState = { ...currentState, ...updates };
            localStorage.setItem(this.storageKey, JSON.stringify(newState));
            this.notifyListeners();
          }

          joinGame(playerId, country) {
            const state = this.getState();
            if (Object.values(state.players).some(p => p.country === country)) {
              return { success: false, message: 'Country already taken' };
            }
            state.players[playerId] = { id: playerId, country: country, joinedAt: Date.now() };
            this.setState(state);
            return { success: true };
          }

          leaveGame(playerId) {
            const state = this.getState();
            delete state.players[playerId];
            this.setState(state);
          }

          submitVote(playerId, issueId, optionId) {
            const state = this.getState();
            const player = state.players[playerId];
            if (!player) return { success: false };
            const voteKey = `${issueId}-${player.country}`;
            state.votes[voteKey] = optionId;
            this.setState(state);
            return { success: true };
          }

          setPlayerReady(playerId, ready) {
            const state = this.getState();
            if (ready) {
              if (!state.readyPlayers.includes(playerId)) {
                state.readyPlayers.push(playerId);
              }
            } else {
              state.readyPlayers = state.readyPlayers.filter(id => id !== playerId);
            }
            this.setState(state);
          }

          allPlayersReady() {
            const state = this.getState();
            const playerCount = Object.keys(state.players).length;
            return playerCount > 0 && state.readyPlayers.length === playerCount;
          }

          startGame() {
            const state = this.getState();
            state.gameStarted = true;
            state.currentRound = 1;
            state.gamePhase = 'voting';
            state.readyPlayers = [];
            this.setState(state);
          }

          nextRound() {
            const state = this.getState();
            const currentIssue = issues[state.currentRound - 1];
            
            if (currentIssue) {
              // Count votes for each option
              const voteCounts = {};
              currentIssue.options.forEach(opt => voteCounts[opt.id] = 0);
              
              Object.keys(state.players).forEach(playerId => {
                const player = state.players[playerId];
                const voteKey = `${currentIssue.id}-${player.country}`;
                const votedOptionId = state.votes[voteKey];
                if (votedOptionId) {
                  voteCounts[votedOptionId] = (voteCounts[votedOptionId] || 0) + 1;
                }
              });
              
              // Find winning option (most votes)
              let winningOptionId = null;
              let maxVotes = -1;
              Object.entries(voteCounts).forEach(([optId, count]) => {
                if (count > maxVotes) {
                  maxVotes = count;
                  winningOptionId = optId;
                }
              });
              
              // Award points based on winning option
              if (winningOptionId) {
                const winningOption = currentIssue.options.find(opt => opt.id === winningOptionId);
                if (winningOption) {
                  Object.keys(state.players).forEach(playerId => {
                    const player = state.players[playerId];
                    
                    // Award points if winning option favors this country
                    if (winningOption.favors.includes(player.country)) {
                      state.scores[player.country] += 10;
                    }
                    
                    // Deduct points if winning option opposes this country
                    if (winningOption.opposes.includes(player.country)) {
                      state.scores[player.country] -= 5;
                    }
                  });
                  
                  // Store round result
                  state.roundHistory.push({
                    round: state.currentRound,
                    issue: currentIssue.title,
                    winningOption: winningOption.text,
                    votes: voteCounts
                  });
                }
              }
            }
            
            if (state.currentRound < issues.length) {
              state.currentRound += 1;
              state.readyPlayers = [];
              state.gamePhase = 'voting';
            } else {
              state.gamePhase = 'complete';
            }
            this.setState(state);
          }

          resetGame() {
            const initialState = {
              gameId: Date.now(),
              gameStarted: false,
              currentRound: 0,
              players: {},
              votes: {},
              readyPlayers: [],
              gamePhase: 'lobby',
              scores: { USA: 0, UK: 0, USSR: 0, France: 0, China: 0 },
              roundHistory: []
            };
            localStorage.setItem(this.storageKey, JSON.stringify(initialState));
            this.notifyListeners();
          }

          subscribe(callback) {
            this.listeners.push(callback);
            return () => {
              this.listeners = this.listeners.filter(cb => cb !== callback);
            };
          }

          notifyListeners() {
            this.listeners.forEach(callback => callback(this.getState()));
          }
        }

        const gameState = new GameStateManager();

        // React App
        const { useState, useEffect } = React;

        const BrettonWoodsMultiplayer = () => {
          const [playerId] = useState(() => {
            let id = sessionStorage.getItem('brettonWoodsPlayerId');
            if (!id) {
              id = `player_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
              sessionStorage.setItem('brettonWoodsPlayerId', id);
            }
            return id;
          });
          
          const [playerCountry, setPlayerCountry] = useState(null);
          const [isReady, setIsReady] = useState(false);
          const [gameStateData, setGameStateData] = useState(null);
          const [showEconomics, setShowEconomics] = useState(false);

          useEffect(() => {
            const updateState = (state) => {
              setGameStateData(state);
              const player = state.players[playerId];
              if (player) setPlayerCountry(player.country);
            };

            updateState(gameState.getState());
            const unsubscribe = gameState.subscribe(updateState);
            const pollInterval = setInterval(() => updateState(gameState.getState()), 1000);

            return () => {
              unsubscribe();
              clearInterval(pollInterval);
            };
          }, [playerId]);

          const joinGame = (country) => {
            const result = gameState.joinGame(playerId, country);
            if (result.success) {
              setPlayerCountry(country);
            } else {
              alert(result.message);
            }
          };

          const leaveGame = () => {
            gameState.leaveGame(playerId);
            setPlayerCountry(null);
            setIsReady(false);
          };

          const toggleReady = () => {
            const newReady = !isReady;
            setIsReady(newReady);
            gameState.setPlayerReady(playerId, newReady);
          };

          const startGame = () => {
            if (gameState.allPlayersReady()) {
              gameState.startGame();
            }
          };

          const submitVote = (issueId, optionId) => {
            gameState.submitVote(playerId, issueId, optionId);
          };

          const advanceRound = () => {
            if (gameState.allPlayersReady()) {
              gameState.nextRound();
            }
          };

          // Reset ready state when round changes
          useEffect(() => {
            if (gameStateData) {
              setIsReady(gameStateData.readyPlayers.includes(playerId));
            }
          }, [gameStateData?.currentRound, playerId]);

          const resetGame = () => {
            if (confirm('Are you sure you want to reset the game for all players?')) {
              gameState.resetGame();
              setPlayerCountry(null);
              setIsReady(false);
            }
          };

          const emergencyReset = () => {
            if (confirm('EMERGENCY RESET: This will clear everything and restart. Continue?')) {
              sessionStorage.clear();
              localStorage.clear();
              window.location.reload();
            }
          };

          // Emergency reset button (always visible)
          const EmergencyResetButton = () => (
            <button 
              className="emergency-reset"
              onClick={emergencyReset}
              title="Emergency Reset - Clear everything and restart"
            >
              üÜò Emergency Reset
            </button>
          );

          if (!gameStateData) {
            return (
              <div className="container">
                <div className="card">
                  <p style={{ textAlign: 'center', padding: '40px' }}>Loading game...</p>
                </div>
              </div>
            );
          }

          const currentIssue = issues[gameStateData.currentRound - 1];
          const availableCountries = Object.keys(countries).filter(
            country => !Object.values(gameStateData.players).some(p => p.country === country)
          );

          // Lobby Screen
          if (!gameStateData.gameStarted && gameStateData.gamePhase === 'lobby') {
            return (
              <div className="container">
                <EmergencyResetButton />
                <div className="header">
                  <h1>üåç Bretton Woods 1944</h1>
                  <p>Multiplayer Simulation - Lobby</p>
                </div>

                <div className="card">
                  <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '20px' }}>
                    <h2 style={{ fontSize: '1.5rem', color: '#1e293b' }}>Game Lobby</h2>
                    <div style={{ fontSize: '0.875rem', color: '#64748b' }}>
                      Room: {gameStateData.gameId}
                    </div>
                  </div>

                  <div style={{ marginBottom: '30px' }}>
                    <h3 style={{ fontSize: '1.125rem', marginBottom: '16px' }}>
                      üë• Players ({Object.keys(gameStateData.players).length}/5)
                    </h3>
                    
                    <div style={{ display: 'grid', gap: '12px' }}>
                      {Object.entries(gameStateData.players).map(([id, player]) => (
                        <div key={id} style={{
                          display: 'flex',
                          justifyContent: 'space-between',
                          padding: '12px',
                          background: id === playerId ? '#eff6ff' : '#f8fafc',
                          borderRadius: '8px',
                          borderLeft: '4px solid ' + (id === playerId ? '#3b82f6' : '#cbd5e1')
                        }}>
                          <div>
                            <span className={countries[player.country].textColor} style={{ fontWeight: 'bold' }}>
                              {countries[player.country].name}
                            </span>
                            {id === playerId && <span style={{ marginLeft: '8px', fontSize: '0.875rem', color: '#3b82f6' }}>(You)</span>}
                          </div>
                          <div>
                            {gameStateData.readyPlayers.includes(id) ? (
                              <span style={{ color: '#16a34a', fontWeight: 'bold' }}>‚úì Ready</span>
                            ) : (
                              <span style={{ color: '#64748b' }}>Not Ready</span>
                            )}
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>

                  {!playerCountry ? (
                    <div>
                      <h3 style={{ fontSize: '1.125rem', marginBottom: '16px' }}>Select Your Nation</h3>
                      <div className="country-grid">
                        {availableCountries.map(key => (
                          <div key={key} className={`country-card ${countries[key].color}`} onClick={() => joinGame(key)}>
                            <h3>{countries[key].name}</h3>
                            <p style={{ fontSize: '0.875rem', marginBottom: '12px', opacity: 0.9 }}>
                              {countries[key].economicPosition}
                            </p>
                            <ul>
                              {countries[key].objectives.map((obj, idx) => (
                                <li key={idx}>{obj}</li>
                              ))}
                            </ul>
                          </div>
                        ))}
                      </div>
                    </div>
                  ) : (
                    <div style={{ textAlign: 'center' }}>
                      <div style={{ marginBottom: '20px', padding: '20px', background: '#f8fafc', borderRadius: '8px' }}>
                        <p style={{ color: '#64748b', marginBottom: '8px' }}>You are playing as</p>
                        <h2 className={countries[playerCountry].textColor} style={{ fontSize: '1.75rem' }}>
                          {countries[playerCountry].name}
                        </h2>
                      </div>
                      
                      <div style={{ display: 'flex', gap: '12px', justifyContent: 'center', flexWrap: 'wrap' }}>
                        <button className={isReady ? 'btn-success' : 'btn-primary'} onClick={toggleReady}>
                          {isReady ? '‚úì Ready' : 'Mark Ready'}
                        </button>
                        <button className="btn-secondary" onClick={leaveGame}>‚Üê Leave Game</button>
                        {Object.keys(gameStateData.players).length > 1 && gameState.allPlayersReady() && (
                          <button className="btn-success" onClick={startGame}>üéÆ Start Conference</button>
                        )}
                      </div>

                      <button className="btn-danger" onClick={resetGame} style={{ marginTop: '20px' }}>
                        üîÑ Reset Game
                      </button>
                    </div>
                  )}
                </div>
              </div>
            );
          }

          // Game Complete
          if (gameStateData.gamePhase === 'complete') {
            const sortedScores = Object.entries(gameStateData.scores).sort((a, b) => b[1] - a[1]);
            const winner = sortedScores[0];

            return (
              <div className="container">
                <EmergencyResetButton />
                <div className="header">
                  <h1>üèÜ Conference Results</h1>
                  <p>Final Outcomes</p>
                </div>

                <div className="card">
                  <h2 style={{ textAlign: 'center', marginBottom: '20px' }}>
                    {countries[winner[0]].name} Wins!
                  </h2>

                  <div className="final-scores">
                    {sortedScores.map(([country, score]) => (
                      <div key={country} className={`score-card ${countries[country].color}`}>
                        <h3>{countries[country].name}</h3>
                        <div className="score-value">{score}</div>
                      </div>
                    ))}
                  </div>

                  <div style={{ textAlign: 'center' }}>
                    <button className="btn-primary" onClick={resetGame}>üîÑ Play Again</button>
                  </div>
                </div>
              </div>
            );
          }

          // Voting Screen
          if (!playerCountry) {
            return (
              <div className="container">
                <EmergencyResetButton />
                <div className="header">
                  <h1>üåç Bretton Woods Conference</h1>
                  <p>Round {gameStateData.currentRound} of {issues.length}</p>
                </div>
                <div className="card">
                  <h3 style={{ textAlign: 'center', color: '#dc2626', marginBottom: '20px' }}>
                    ‚ö†Ô∏è You Are Not in the Current Game
                  </h3>
                  <p style={{ textAlign: 'center', color: '#64748b', marginBottom: '30px' }}>
                    The game started without you, or there was a connection issue.
                  </p>
                  <div style={{ textAlign: 'center' }}>
                    <button 
                      className="btn-danger" 
                      onClick={resetGame}
                      style={{ marginRight: '12px' }}
                    >
                      üîÑ Reset Game for Everyone
                    </button>
                    <button 
                      className="btn-secondary" 
                      onClick={() => {
                        sessionStorage.clear();
                        localStorage.clear();
                        window.location.reload();
                      }}
                    >
                      üîÑ Clear & Reload Page
                    </button>
                  </div>
                  <p style={{ textAlign: 'center', color: '#64748b', fontSize: '0.875rem', marginTop: '20px' }}>
                    "Clear & Reload" will reset your browser and return you to the lobby.
                  </p>
                </div>
              </div>
            );
          }

          const myCountry = countries[playerCountry];
          const myVoteKey = `${currentIssue.id}-${playerCountry}`;
          const myVote = gameStateData.votes[myVoteKey];
          const allVotesIn = Object.keys(gameStateData.players).every(pid => {
            const p = gameStateData.players[pid];
            const voteKey = `${currentIssue.id}-${p.country}`;
            return gameStateData.votes[voteKey] !== undefined;
          });

          return (
            <div className="container">
              <EmergencyResetButton />
              <div className="header">
                <h1>üåç Bretton Woods Conference</h1>
                <p>Round {gameStateData.currentRound} of {issues.length}</p>
              </div>

              <div className="card" style={{ marginBottom: '20px' }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', flexWrap: 'wrap', gap: '16px' }}>
                  <div>
                    <h3 className={myCountry.textColor} style={{ fontSize: '1.25rem', marginBottom: '4px' }}>
                      {myCountry.name}
                    </h3>
                    <p style={{ color: '#64748b', fontSize: '0.875rem' }}>
                      Score: {gameStateData.scores[playerCountry]} points
                    </p>
                  </div>
                  <div>
                    <button className="btn-secondary" onClick={() => setShowEconomics(!showEconomics)}>
                      {showEconomics ? 'Hide' : 'Show'} Economic Data
                    </button>
                  </div>
                </div>
              </div>

              {showEconomics && (
                <div className="card">
                  <h3 style={{ marginBottom: '20px' }}>Economic Position - 1944</h3>
                  <div className="economic-grid">
                    <div className="economic-card">
                      <h4>Gold Reserves</h4>
                      <p>${economicData[playerCountry].goldReserves}M</p>
                    </div>
                    <div className="economic-card">
                      <h4>GDP</h4>
                      <p>${economicData[playerCountry].gdp}M</p>
                    </div>
                    <div className="economic-card">
                      <h4>War Debt</h4>
                      <p>${economicData[playerCountry].warDebt}M</p>
                    </div>
                  </div>
                </div>
              )}

              <div className="card">
                <h2>{currentIssue.title}</h2>
                <p style={{ color: '#64748b', margin: '16px 0' }}>{currentIssue.description}</p>

                <div style={{ marginTop: '20px' }}>
                  <h3 style={{ marginBottom: '16px', fontSize: '1.125rem' }}>Options:</h3>
                  {currentIssue.options.map((option, idx) => {
                    const favorsYou = option.favors.includes(playerCountry);
                    const opposesYou = option.opposes.includes(playerCountry);
                    const isSelected = myVote === option.id;
                    
                    return (
                      <div 
                        key={option.id} 
                        onClick={() => myVote === undefined && submitVote(currentIssue.id, option.id)}
                        style={{ 
                          padding: '16px', 
                          background: isSelected ? '#3b82f6' : (favorsYou ? '#dcfce7' : opposesYou ? '#fee2e2' : '#f8fafc'),
                          borderRadius: '8px',
                          marginBottom: '12px',
                          borderLeft: '4px solid ' + (isSelected ? '#1e40af' : favorsYou ? '#16a34a' : opposesYou ? '#dc2626' : '#3b82f6'),
                          cursor: myVote === undefined ? 'pointer' : 'default',
                          transition: 'all 0.2s',
                          color: isSelected ? 'white' : 'inherit'
                        }}
                      >
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                          <div style={{ flex: 1 }}>
                            <strong style={{ fontSize: '1.125rem' }}>{String.fromCharCode(65 + idx)}.</strong> {option.text}
                          </div>
                          <div style={{ display: 'flex', gap: '8px', alignItems: 'center', marginLeft: '16px' }}>
                            {isSelected && <span style={{ fontWeight: 'bold' }}>‚úì SELECTED</span>}
                            {!isSelected && favorsYou && <span style={{ color: '#16a34a', fontSize: '0.875rem' }}>‚úì Favors you (+10)</span>}
                            {!isSelected && opposesYou && <span style={{ color: '#dc2626', fontSize: '0.875rem' }}>‚úó Opposes you (-5)</span>}
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>

                <div style={{ marginTop: '30px', padding: '20px', background: '#f8fafc', borderRadius: '8px', textAlign: 'center' }}>
                  {myVote === undefined ? (
                    <p style={{ color: '#64748b' }}>
                      üëÜ Click on an option above to cast your vote
                    </p>
                  ) : (
                    <div>
                      <p style={{ fontSize: '1.125rem', color: '#16a34a', fontWeight: 'bold', marginBottom: '12px' }}>
                        ‚úì Vote Cast for Option {String.fromCharCode(65 + currentIssue.options.findIndex(o => o.id === myVote))}
                      </p>
                      <button className="btn-secondary" onClick={() => submitVote(currentIssue.id, undefined)}>
                        Change Vote
                      </button>
                    </div>
                  )}
                </div>

                {myVote !== undefined && !allVotesIn && (
                  <div style={{ marginTop: '20px', padding: '16px', background: '#fef3c7', borderRadius: '8px', textAlign: 'center' }}>
                    <p style={{ color: '#92400e' }}>‚è≥ Waiting for other players...</p>
                  </div>
                )}

                {allVotesIn && (
                  <div style={{ marginTop: '20px' }}>
                    <div style={{ marginBottom: '16px', padding: '16px', background: '#dcfce7', borderRadius: '8px' }}>
                      <p style={{ color: '#166534', textAlign: 'center', fontWeight: 'bold', marginBottom: '12px' }}>
                        ‚úì All players have voted!
                      </p>
                      {(() => {
                        // Calculate vote counts
                        const voteCounts = {};
                        currentIssue.options.forEach(opt => voteCounts[opt.id] = 0);
                        
                        Object.keys(gameStateData.players).forEach(pid => {
                          const p = gameStateData.players[pid];
                          const vk = `${currentIssue.id}-${p.country}`;
                          const vote = gameStateData.votes[vk];
                          if (vote) voteCounts[vote]++;
                        });
                        
                        // Find winner
                        let winningId = null;
                        let maxVotes = -1;
                        Object.entries(voteCounts).forEach(([optId, count]) => {
                          if (count > maxVotes) {
                            maxVotes = count;
                            winningId = optId;
                          }
                        });
                        
                        const winningOption = currentIssue.options.find(o => o.id === winningId);
                        
                        return (
                          <div style={{ marginTop: '12px' }}>
                            <p style={{ color: '#166534', fontSize: '0.875rem', textAlign: 'center' }}>
                              <strong>Vote Results:</strong>
                            </p>
                            {currentIssue.options.map((opt, idx) => (
                              <p key={opt.id} style={{ 
                                color: opt.id === winningId ? '#166534' : '#64748b',
                                fontSize: '0.875rem',
                                textAlign: 'center',
                                fontWeight: opt.id === winningId ? 'bold' : 'normal'
                              }}>
                                {opt.id === winningId ? 'üèÜ ' : ''}
                                Option {String.fromCharCode(65 + idx)}: {voteCounts[opt.id]} vote{voteCounts[opt.id] !== 1 ? 's' : ''}
                                {opt.id === winningId ? ' - WINNER!' : ''}
                              </p>
                            ))}
                            {winningOption && (
                              <div style={{ marginTop: '12px', padding: '12px', background: '#f0fdf4', borderRadius: '6px' }}>
                                <p style={{ fontSize: '0.875rem', color: '#166534' }}>
                                  <strong>Adopted Policy:</strong> {winningOption.text}
                                </p>
                              </div>
                            )}
                          </div>
                        );
                      })()}
                    </div>
                    
                    <div style={{ textAlign: 'center' }}>
                      <button className={isReady ? 'btn-success' : 'btn-primary'} onClick={toggleReady} style={{ marginRight: '12px' }}>
                        {isReady ? '‚úì Ready' : 'Mark Ready'}
                      </button>
                      
                      {gameState.allPlayersReady() && (
                        <button className="btn-success" onClick={advanceRound}>
                          {gameStateData.currentRound < issues.length ? 'Next Round ‚Üí' : 'See Results'}
                        </button>
                      )}
                    </div>
                    
                    <p style={{ textAlign: 'center', marginTop: '12px', fontSize: '0.875rem', color: '#64748b' }}>
                      {gameStateData.readyPlayers.length} / {Object.keys(gameStateData.players).length} ready
                    </p>
                  </div>
                )}
              </div>
            </div>
          );
        };

        ReactDOM.render(<BrettonWoodsMultiplayer />, document.getElementById('root'));
    </script>
</body>
</html>
